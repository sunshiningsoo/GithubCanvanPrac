# workflow ì˜ ì´ë¦„
name: test_on_dev

on:
    # develop ë¸Œëœì¹˜ì— push ë‚˜ pull request ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚¬ì„ë•Œ í•´ë‹¹ workflow ë¥¼ trigger
    push:
      branches: [ main ]
    pull_request:
      branches: [ main ]

# workflowì˜ ì‹¤í–‰ì€ í•˜ë‚˜ ì´ìƒì˜ jobìœ¼ë¡œ êµ¬ì„± ë¨
jobs:
    # ì´ workflow ëŠ” "build" ë¼ëŠ” single job ìœ¼ë¡œ êµ¬ì„±
    build:
    # jobì´ ì‹¤í–‰ë  í™˜ê²½ - ìµœì‹  mac os
      runs-on: macos-latest
    
      env:
        CLIENT_ID: ${{ secrets.CLIENT_ID}}
        REVERSED_CLIENT_ID: ${{ secrets.REVERSED_CLIENT_ID}}
        API_KEY: ${{ secrets.API_KEY}}
        GCM_SENDER_ID: ${{ secrets.GCM_SENDER_ID}}
        PLIST_VERSION: ${{ secrets.PLIST_VERSION}}
        BUNDLE_ID: ${{ secrets.BUNDLE_ID}}
        PROJECT_ID: ${{ secrets.PROJECT_ID}}
        STORAGE_BUCKET: ${{ secrets.STORAGE_BUCKET}}
        IS_ADS_ENABLED: ${{ secrets.IS_ADS_ENABLED}}
        IS_ANALYTICS_ENABLED: ${{ secrets.IS_ANALYTICS_ENABLED}}
        IS_APPINVITE_ENABLED: ${{ secrets.IS_APPINVITE_ENABLED}}
        IS_GCM_ENABLED: ${{ secrets.IS_GCM_ENABLED}}
        IS_SIGNIN_ENABLED: ${{ secrets.IS_SIGNIN_ENABLED}}
        GOOGLE_APP_ID: ${{ secrets.GOOGLE_APP_ID}}
    
    # Stepì€ jobì˜ ì¼ë¶€ë¡œ ì‹¤í–‰ë  ì¼ë ¨ì˜ taskë“¤ì„ ë‚˜íƒ€ëƒ„
      steps:
    # uses í‚¤ì›Œë“œë¥¼ í†µí•´ Github Actionsì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì•¡ì…˜ì„ ì‚¬ìš© ê°€ëŠ¥. ì•„ë˜ ì•¡ì…˜ì€ repository ì— ì²´í¬ì•„ì›ƒí•˜ëŠ” ê²ƒ
      - uses: actions/checkout@v3
      - name: GoogleServieInfomake
        run: |
          echo "CLIENT_ID=$CLIENT_ID" >> GoogleServieInfo.plist
          echo "REVERSED_CLIENT_ID=$REVERSED_CLIENT_ID" >> GoogleServieInfo.plist
          echo "API_KEY=$API_KEY" >> GoogleServieInfo.plist
          echo "GCM_SENDER_ID=$GCM_SENDER_ID" >> GoogleServieInfo.plist
          echo "PLIST_VERSION=$PLIST_VERSION" >> GoogleServieInfo.plist
          echo "BUNDLE_ID=$BUNDLE_ID" >> GoogleServieInfo.plist
          echo "PROJECT_ID=$PROJECT_ID" >> GoogleServieInfo.plist
          echo "STORAGE_BUCKET=$STORAGE_BUCKET" >> GoogleServieInfo.plist
          echo "IS_ADS_ENABLED=$IS_ADS_ENABLED" >> GoogleServieInfo.plist
          echo "IS_ANALYTICS_ENABLED=$IS_ANALYTICS_ENABLED" >> GoogleServieInfo.plist
          echo "IS_APPINVITE_ENABLED=$IS_APPINVITE_ENABLED" >> GoogleServieInfo.plist
          echo "IS_GCM_ENABLED=$IS_GCM_ENABLED" >> GoogleServieInfo.plist
          echo "IS_SIGNIN_ENABLED=$IS_SIGNIN_ENABLED" >> GoogleServieInfo.plist
          echo "GOOGLE_APP_ID=$GOOGLE_APP_ID" >> GoogleServieInfo.plist
        
    
    # shell ì´ìš©í•´ì„œ í•˜ë‚˜ì˜ command ìˆ˜í–‰
      - name: Start xcode build ğŸ› 
        run: |
          xcodebuild clean build -project GithubCanvanPrac.xcodeproj -scheme GithubCanvanPrac -destination 'platform=iOS Simulator,name=iPhone 13 Pro Max'
